!function(){"use strict";window.XHR={_init:function(){return new XMLHttpRequest},post:function(e,t){var n=this._init();t=t||function(){},n.open("POST",e.url,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(e.data),n.onreadystatechange=function(){200===n.status&&4===n.readyState&&t(n.responseText)}},getJSON:function(e,t){var n,a=this._init(),o=(e.url=e.url||location.href,t=t||function(){},e.type=e.type||"json",e.url);"jsonp"===e.type&&(window.jsonCallback=t,o=o.replace("callback=?","callback=jsonCallback"),(n=document.createElement("script")).src=o,document.body.appendChild(n)),a.open("GET",e.url,!0),a.send(),a.onreadystatechange=function(){200===a.status&&4===a.readyState&&t(a.responseText)}}}}(),function(h,m){"use strict";var n,a;function g(e){return m.getElementById(e)}function o(){n.value=a(n.value)}function b(e,t){n=e,a=t,h.setTimeout(o,1)}function y(e){return e=(e=e.replace(/\D/g,"")).replace(/^(\d{5})(\d)/,"$1-$2")}function k(e){return e=(e=(e=e.replace(/\D/g,"")).replace(/^(\d{2})(\d)/g,"($1) $2")).replace(/(\d)(\d{4})$/,"$1-$2")}function E(e){g("address").innerHTML="Não foi possível obter sua posição."}function L(e){var e="geo/"+e.coords.latitude+","+e.coords.longitude+"&callback=?",t=g("cep"),n=g("address");t.value="Procurando..",XHR.getJSON({url:e},function(e){e=JSON.parse(e);n.innerHTML=e.address,t.value=e.cep})}h.onload=function(){var n=g("nome"),a=g("sobrenome"),o=g("telefone"),r=g("cep"),i=g("numero"),u=g("email"),c=g("detalhes"),s=m.querySelectorAll('input[name="sabor[]"]'),e=m.querySelector(".tweet"),t=m.querySelector(".like"),l=m.querySelector(".youtube"),d=g("address"),p=g("js-geo"),f=g("phone"),v=g("form"),s=[].slice.call(s);o.addEventListener("keypress",function(){b(this,k)}),r.addEventListener("keypress",function(){b(this,y)}),r.addEventListener("keyup",function(){d.innerHTML=""}),e.addEventListener("click",function(){_gaq.push(["_trackEvent","twitter Button",this.href,this.title])}),t.addEventListener("click",function(){_gaq.push(["_trackEvent","facebook Button",this.href,this.title])}),l.addEventListener("click",function(){_gaq.push(["_trackEvent","youtube Button",this.href,this.title])}),p.addEventListener("click",function(){navigator.geolocation.getCurrentPosition(L,E)}),v.addEventListener("submit",function(e){var t;return e.preventDefault(),""===o.value?(alert("Digite seu telefone para que eu possa te ligar e confirmar teu pedido!!"),o.focus(),!1):""===r.value?(alert("Informe o cep, para eu conseguir te entregar"),r.focus(),!1):""===u.value?(alert("Me diga seu email =)"),u.focus(),!1):(t="nome="+n.value+"&sobrenome="+a.value+"&telefone="+o.value+"&cep="+r.value+"&numero="+i.value+"&email="+u.value+"&detalhes="+c.value,s.forEach(function(e){e.checked&&(t+="&sabor[]="+e.value)}),void XHR.post({url:v.getAttribute("action"),data:t},function(e){"ok"===JSON.parse(e).status?alert("Tudo certo! já já lhe enviaremos um email para combinar a data de entrega."):alert("Por favor tente novamente, ou nos peça por email tegustaempanadas@gmail.com")}))}),XHR.getJSON({url:"/telephone"},function(e){e=JSON.parse(e);f.innerHTML='<i class="ico-phone"></i>'+e.telephone}),h.scrollTo(0,1),f.setAttribute("href",g("phone").getAttribute("data-href")),f.removeAttribute("data-href"),navigator.geolocation&&(p.style.display="block")}}(window,document);