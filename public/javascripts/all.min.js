!function(){"use strict";window.XHR={_init:function(){var e=new XMLHttpRequest;return e},post:function(e,t){var n=this._init();t=t||function(){},n.open("POST",e.url,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(e.data),n.onreadystatechange=function(){200===n.status&&4===n.readyState&&t(n.responseText)}},getJSON:function(e,t){var n=this._init();e.url=e.url||location.href,t=t||function(){},e.type=e.type||"json";var a=e.url;if("jsonp"===e.type){window.jsonCallback=t;var o=a.replace("callback=?","callback=jsonCallback"),r=document.createElement("script");r.src=o,document.body.appendChild(r)}n.open("GET",e.url,!0),n.send(),n.onreadystatechange=function(){200===n.status&&4===n.readyState&&t(n.responseText)}}}}(),function(e,t,n){"use strict";function a(e){return t.getElementById(e)}function o(){l.value=d(l.value)}function r(t,n){l=t,d=n,e.setTimeout(o,1)}function i(e){return e=e.replace(/\D/g,""),e=e.replace(/^(\d{5})(\d)/,"$1-$2")}function u(e){return e=e.replace(/\D/g,""),e=e.replace(/^(\d{2})(\d)/g,"($1) $2"),e=e.replace(/(\d)(\d{4})$/,"$1-$2")}function c(e){var t=a("address");t.innerHTML="Não foi possível obter sua posição."}function s(e){var t="geo/"+e.coords.latitude+","+e.coords.longitude+"&callback=?",n=a("cep"),o=a("address");n.value="Procurando..",XHR.getJSON({url:t},function(e){var t=JSON.parse(e);o.innerHTML=t.address,n.value=t.cep})}var l,d;e.onload=function(){var n=a("nome"),o=a("sobrenome"),l=a("telefone"),d=a("cep"),f=a("numero"),p=a("email"),v=a("detalhes"),h=t.querySelectorAll('input[name="sabor[]"]'),m=t.querySelector(".tweet"),g=t.querySelector(".like"),b=t.querySelector(".youtube"),y=a("address"),k=a("js-geo"),E=a("phone"),L=a("form");h=[].slice.call(h),l.addEventListener("keypress",function(){r(this,u)}),d.addEventListener("keypress",function(){r(this,i)}),d.addEventListener("keyup",function(){y.innerHTML=""}),m.addEventListener("click",function(){_gaq.push(["_trackEvent","twitter Button",this.href,this.title])}),g.addEventListener("click",function(){_gaq.push(["_trackEvent","facebook Button",this.href,this.title])}),b.addEventListener("click",function(){_gaq.push(["_trackEvent","youtube Button",this.href,this.title])}),k.addEventListener("click",function(){navigator.geolocation.getCurrentPosition(s,c)}),L.addEventListener("submit",function(e){if(e.preventDefault(),""===l.value)return alert("Digite seu telefone para que eu possa te ligar e confirmar teu pedido!!"),l.focus(),!1;if(""===d.value)return alert("Informe o cep, para eu conseguir te entregar"),d.focus(),!1;if(""===p.value)return alert("Me diga seu email =)"),p.focus(),!1;var t="nome="+n.value+"&sobrenome="+o.value+"&telefone="+l.value+"&cep="+d.value+"&numero="+f.value+"&email="+p.value+"&detalhes="+v.value;h.forEach(function(e){e.checked&&(t+="&sabor[]="+e.value)}),XHR.post({url:L.getAttribute("action"),data:t},function(e){var t=JSON.parse(e);"ok"===t.status?alert("Tudo certo! já já lhe enviaremos um email para combinar a data de entrega."):alert("Por favor tente novamente, ou nos peça por email strudelfolhadinho@gmail.com")})}),XHR.getJSON({url:"/telephone"},function(e){var t=JSON.parse(e);E.innerHTML='<i class="ico-phone"></i>'+t.telephone}),e.scrollTo(0,1),E.setAttribute("href",a("phone").getAttribute("data-href")),E.removeAttribute("data-href"),navigator.geolocation&&(k.style.display="block")}}(window,document);